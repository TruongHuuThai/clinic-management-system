<!DOCTYPE html>
<html lang="vi">
<head>
    <%- include('partials/head') %>
    <title><%= title %></title>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.2/themes/base/jquery-ui.css">
</head>
<body>
    <%- include('partials/header') %>
    <div class="container mt-4">
        <h2><%= title %></h2>

        <% if (error) { %>
            <div class="alert alert-danger"><%= error %></div>
        <% } %>

        <form action="/api/patients" method="POST" id="patientForm">
            
            <div class="form-group">
                <label for="ten_benh_nhan">Tên Bệnh nhân <span class="text-danger">*</span></label>
                <input type="text" id="ten_benh_nhan" name="ten_benh_nhan" class="form-control" value="<%= patient.ten_benh_nhan || '' %>" required>
            </div>

            <div class="form-group">
                <label for="ngay_sinh">Ngày Sinh</label>
                <input type="text" id="ngay_sinh" name="ngay_sinh" class="form-control datepicker-input" value="<%= patient.ngay_sinh || '' %>" placeholder="dd/mm/yyyy">
            </div>

            <div class="form-group">
                <label>Giới Tính</label>
                <% const currentGender = 'Nam'; %>
                
                <div class="radio-group-container">
                    
                    <label for="gioi_tinh_nam" class="radio-label">
                        <input type="radio" id="gioi_tinh_nam" name="gioi_tinh" value="Nam" 
                        <%= currentGender === 'Nam' ? 'checked' : '' %> required> 
                        Nam
                    </label>
                    
                    <label for="gioi_tinh_nu" class="radio-label">
                        <input type="radio" id="gioi_tinh_nu" name="gioi_tinh" value="Nữ" 
                        <%= currentGender === 'Nữ' ? 'checked' : '' %> required> 
                        Nữ
                    </label>
                    
                </div>
                
                <% if (!currentGender) { %>
                    <% } %>
            </div>
            
            <div class="form-group">
                <label for="so_dien_thoai">Số Điện Thoại</label>
                <input type="text" id="so_dien_thoai" name="so_dien_thoai" class="form-control" value="<%= patient.so_dien_thoai || '' %>" required>
            </div>

            <div class="form-group">
                <label for="dia_chi">Địa Chỉ</label>
                <input type="text" id="dia_chi" name="dia_chi" class="form-control" value="<%= patient.dia_chi || '' %>">
            </div>

            <button type="submit" class="btn btn-primary">Lưu Bệnh nhân</button>
            <button type="button" class="btn btn-primary" onclick="danhSachBenhNhan()">Hủy</button>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://code.jquery.com/ui/1.13.2/jquery-ui.min.js"></script>
    <script src="/js/partials/header.js"></script>
    <script>
        $(document).ready(function() {
            $("#ngay_sinh").datepicker({
                dateFormat: 'dd/mm/yy',
                changeMonth: true,
                changeYear: true,
                yearRange: "1940:2030",
                closeText: 'Đóng',
                currentText: 'Hôm nay',
            });

            $('#patientForm').submit(function(e) {
                let $dateInput = $('#ngay_sinh');
                let dateString = $dateInput.val(); 

                if (dateString && dateString.includes('/')) {
                    let parts = dateString.split('/'); 
                    let isoDate = `${parts[2]}-${parts[1]}-${parts[0]}`;
                    
                    $dateInput.val(isoDate);
                }
            });
            let $ngaySinhInput = $('#ngay_sinh');
            let isoValue = $ngaySinhInput.val();
            if (isoValue && isoValue.includes('-') && isoValue.length === 10) {
                 let parts = isoValue.split('-'); // [YYYY, MM, DD]
                 let displayValue = parts[2] + '/' + parts[1] + '/' + parts[0]; // DD/MM/YYYY
                 $ngaySinhInput.val(displayValue);
            }
        });
    </script>
</body>
</html>