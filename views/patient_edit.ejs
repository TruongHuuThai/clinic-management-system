<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title><%= title %></title>
</head>

<body>
    <main>
        <div class="edit-container">
            <h1><%= title %></h1>

            <div class="mb-3">
                <button onclick="window.location.href='/'" class="btn btn-primary">
                    Trang chủ
                </button>
                <button onclick="danhSachBenhNhan()" class="btn btn-primary">
                    Danh sách bệnh nhân
                </button>
                <button onclick="danhSachLichHen()" class="btn btn-primary">
                    Danh sách lịch hẹn
                </button>
            </div>

            <button onclick="quayLaiChiTietHoSo('<%= patient.bn_ma %>')" class="btn btn-primary">
                Quay lại chi tiết hồ sơ
            </button>

            <% 
                if (typeof error !== 'undefined' && error) { 
            %>
                <div class="error-message"><%= error %></div>
            <% } %>

            <form action="/api/patient_detail/edit/<%= patient.bn_ma %>" method="POST">
                
                <div class="form-group">
                    <label>Mã Bệnh nhân: <%= patient.bn_ma %> </label>
                    <input type="hidden" class="form-control" value="<%= patient.bn_ma %>" disabled>
                </div>

                <div class="form-group">
                    <label for="ho_ten">Họ và Tên </label>
                    <input type="text" id="ho_ten" name="ho_ten" class="form-control" 
                           value="<%= patient.bn_ho_ten %>" required>
                </div>

                <div class="form-group">
                    <label for="sdt">Số Điện Thoại</label>
                    <input type="text" id="sdt" name="sdt" class="form-control" 
                           value="<%= patient.bn_sdt || '' %>">
                </div>

                <div class="form-group">
                    <label>Giới Tính</label>
                    <% const currentGender = patient.bn_gioi_tinh; %>
                    <div class="form-control-radio-group">
                        <label class="radio-label">
                            <input type="radio" name="gioi_tinh" value="Nam" 
                                <%= currentGender === 'Nam' ? 'checked' : '' %>> 
                            Nam
                        </label>
                        <label class="radio-label">
                            <input type="radio" name="gioi_tinh" value="Nữ" 
                                <%= currentGender === 'Nữ' ? 'checked' : '' %>> 
                            Nữ
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="ngay_sinh">Ngày Sinh</label>
                    <% 
                        let dob = '';
                        if (patient.bn_ngay_sinh) {
                            // Chuyển đổi đối tượng Date thành định dạng YYYY-MM-DD cho input type="date"
                            dob = new Date(patient.bn_ngay_sinh).toISOString().substring(0, 10);
                        } 
                    %>
                    <input type="date" id="ngay_sinh" name="ngay_sinh" class="form-control" 
                           value="<%= dob %>">
                </div>

                <div class="form-group">
                    <label for="dia_chi">Địa Chỉ</label>
                    <textarea id="dia_chi" name="dia_chi" class="form-control" rows="3"><%= patient.bn_dia_chi || '' %></textarea>
                </div>

                <button type="submit" class="btn-submit">
                    Lưu Cập nhật
                </button>
            </form>
        </div>
    </main>
    <script src="/js/patient_edit.js"></script>
</body>
</html>