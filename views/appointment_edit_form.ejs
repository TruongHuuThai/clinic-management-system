<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <title>
        <%= title %> - Quản Lý Lịch Hẹn
    </title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.3/themes/base/jquery-ui.css">
    <script src="https://code.jquery.com/ui/1.13.3/jquery-ui.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui-datepicker/1.13.0/i18n/jquery.ui.datepicker-vi.min.js"></script>
</head>

<body>
    <%- include('partials/header') %>
    <script>
        function getCurrentDateISO() {
            const now = new Date();
            const offset = now.getTimezoneOffset() * 60000;
            const localISOTime = new Date(now.getTime() - offset).toISOString().substring(0, 10);
            return localISOTime;
        }
        const minDate = getCurrentDateISO();
    </script>
    <main>

        <div class="form-container">
            <h1>
                <%= title %>
            </h1>
            <div class="form-group">
                <label for="bn_ho_ten">Tên Bệnh Nhân:</label>
                <input type="text" class="form-control" id="bn_ho_ten" value="<%= appointmentData.bn_ho_ten %>"
                    readonly>
            </div>
            <hr>

            <form id="editAppointmentForm">
                <input type="hidden" id="lh_ma" name="lh_ma" value="<%= appointmentData.lh_ma %>">

                <div class="form-group">
                    <label for="ngay_hen">Ngày Hẹn:</label>

                    <input type="text" class="form-control datepicker-input" id="ngay_hen" name="ngay_hen"
                        <% 
                            let isoDate = appointmentData.lh_ngay_hen ? new Date(appointmentData.lh_ngay_hen).toISOString().substring(0, 10) : ''; 
                        %>
                        value="<%= isoDate %>" placeholder="dd/mm/yyyy" required>
                </div>

                <div class="form-group">
                    <label for="khung_gio">Khung Giờ:</label>
                    <select class="form-control" id="khung_gio" name="khung_gio" required>
                    </select>
                </div>

                <div class="form-group">
                    <label for="trang_thai">Trạng Thái:</label>
                    <select class="form-control" id="trang_thai" name="trang_thai" required>
                        <option value="CHO_KHAM" <%=appointmentData.lh_trang_thai==='CHO_KHAM' ? 'selected' : '' %>>
                            Chờ Khám
                        </option>
                        <option value="DA_DEN" <%=appointmentData.lh_trang_thai==='DA_DEN' ? 'selected' : '' %>>
                            Đã Đến
                        </option>
                        <option value="DA_HUY" <%=appointmentData.lh_trang_thai==='DA_HUY' ? 'selected' : '' %>>
                            Đã Hủy
                        </option>
                        <option value="TAI_KHAM" <%=appointmentData.lh_trang_thai==='TAI_KHAM' ? 'selected' : '' %>>
                            Tái khám
                        </option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="ghi_chu">Ghi Chú:</label>
                    <textarea class="form-control" id="ghi_chu" name="ghi_chu"
                        rows="3"><%= appointmentData.lh_ghi_chu || '' %></textarea>
                </div>

                <div class="form-actions" style="margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">Lưu Thay Đổi</button>
                    <button type="button" class="btn btn-primary" onclick="danhSachLichHen()">Hủy</button>
                </div>
                
            </form>
        </div>
    </main>
    <script src="/js/partials/header.js"></script>
    <script src="/js/appointment_edit_form.js"></script>
</body>

</html>